<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>《dig挖出DNS的秘密》-linux命令五分钟系列之三十四 | Linux大棚</title>
<link rel="pingback" href="http://roclinux.cn/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="Linux大棚 &raquo; Feed" href="http://roclinux.cn/?feed=rss2" />
<link rel="alternate" type="application/rss+xml" title="Linux大棚 &raquo; 评论Feed" href="http://roclinux.cn/?feed=comments-rss2" />
<link rel="alternate" type="application/rss+xml" title="Linux大棚 &raquo; 《dig挖出DNS的秘密》-linux命令五分钟系列之三十四评论Feed" href="http://roclinux.cn/?feed=rss2&#038;p=2449" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/roclinux.cn\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.2"}};
			!function(a,b,c){function d(a){var c,d=b.createElement("canvas"),e=d.getContext&&d.getContext("2d"),f=String.fromCharCode;return e&&e.fillText?(e.textBaseline="top",e.font="600 32px Arial","flag"===a?(e.fillText(f(55356,56806,55356,56826),0,0),d.toDataURL().length>3e3):"diversity"===a?(e.fillText(f(55356,57221),0,0),c=e.getImageData(16,16,1,1).data.toString(),e.fillText(f(55356,57221,55356,57343),0,0),c!==e.getImageData(16,16,1,1).data.toString()):("simple"===a?e.fillText(f(55357,56835),0,0):e.fillText(f(55356,57135),0,0),0!==e.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='wp-pagenavi-css'  href='http://roclinux.cn/wp-content/plugins/wp-pagenavi/pagenavi-css.css?ver=2.70' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://roclinux.cn/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='cloudy-css'  href='http://roclinux.cn/wp-content/themes/cloudy/style.css?ver=4.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='cloudy-print-css'  href='http://roclinux.cn/wp-content/themes/cloudy/print.css?ver=false' type='text/css' media='print' />
<link rel='stylesheet' id='shCore-css'  href='http://roclinux.cn/wp-content/plugins/syntax-highlighter/3.0.83/css/shCore.css?ver=3.0.83' type='text/css' media='all' />
<link rel='stylesheet' id='shCoreEmacs-css'  href='http://roclinux.cn/wp-content/plugins/syntax-highlighter/3.0.83/css/shCoreEmacs.css?ver=3.0.83' type='text/css' media='all' />
<link rel='stylesheet' id='shThemeEmacs-css'  href='http://roclinux.cn/wp-content/plugins/syntax-highlighter/3.0.83/css/shThemeEmacs.css?ver=3.0.83' type='text/css' media='all' />
<link rel='https://api.w.org/' href='http://roclinux.cn/?rest_route=/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://roclinux.cn/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://roclinux.cn/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='《nslookup通往DNS的桥梁》-linux命令五分钟系列之三十三' href='http://roclinux.cn/?p=2441' />
<link rel='next' title='wordpress代码高亮插件Syntax Highlighter' href='http://roclinux.cn/?p=2459' />
<meta name="generator" content="WordPress 4.4.2" />
<link rel="canonical" href="http://roclinux.cn/?p=2449" />
<link rel='shortlink' href='http://roclinux.cn/?p=2449' />
<link rel="alternate" type="application/json+oembed" href="http://roclinux.cn/?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=http%3A%2F%2Froclinux.cn%2F%3Fp%3D2449" />
<link rel="alternate" type="text/xml+oembed" href="http://roclinux.cn/?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=http%3A%2F%2Froclinux.cn%2F%3Fp%3D2449&#038;format=xml" />
<style type="text/css">
        #header {
            background: url(http://roclinux.cn/wp-content/uploads/2010/06/cropped-heading.jpg) 0 52px no-repeat;
        }
        #heading a,
        #heading .description {
            color: #ffffff;
        }
    </style><style type="text/css" id="custom-background-css">
body.custom-background { background-color: #b9dee8; }
</style>
<!-- wp thread comment 1.4.9.4.002 -->
<style type="text/css" media="screen">
.editComment, .editableComment, .textComment{
	display: inline;
}
.comment-childs{
	border: 1px solid #999;
	margin: 5px 2px 2px 4px;
	padding: 4px 2px 2px 4px;
	background-color: white;
}
.chalt{
	background-color: #E2E2E2;
}
#newcomment{
	border:1px dashed #777;width:90%;
}
#newcommentsubmit{
	color:red;
}
.adminreplycomment{
	border:1px dashed #777;
	width:99%;
	margin:4px;
	padding:4px;
}
.mvccls{
	color: #999;
}
			
</style>
<script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?b66ee8a8373e03de8a5ff8e385d78f15";
      var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
})();
</script>
</head>
<body class="single single-post postid-2449 single-format-standard custom-background">
    <div id="root">
    	<div id="header">
            <div id="access" role="navigation">
                                <div class="menu-header"><ul id="menu-rocmenu" class="menu"><li id="menu-item-3742" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-3742"><a href="http://roclinux.cn/">首页</a></li>
<li id="menu-item-3798" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3798"><a href="http://roclinux.cn/?page_id=3775"><font color=yellow>【看日记学git】</font></a></li>
<li id="menu-item-3799" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3799"><a href="http://roclinux.cn/?page_id=3763"><font color=yellow>【别怕Linux编程】</font></a></li>
<li id="menu-item-3745" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3745"><a href="http://roclinux.cn/?page_id=960">发文流程</a></li>
<li id="menu-item-3748" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3748"><a href="http://roclinux.cn/?page_id=9">版权声明</a></li>
<li id="menu-item-3797" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3797"><a href="http://roclinux.cn/?feed=rss2">RSS</a></li>
</ul></div>            </div>
            <form action="http://roclinux.cn/" id="searchform"><div class="search"><label for="s">Search:</label><input type="text" class="text" value="" name="s" id="s"><input class="button" type="submit" value="Go!" /></div></form><img src="http://roclinux.cn/wp-content/themes/cloudy/img/spacer.gif" alt="WP_Cloudy" />
            <div id="heading">
                                    <h1><a href="http://roclinux.cn">Linux大棚</a></h1>
                    <div class="description">体会Linux，体会一种生活方式。</div>
                            </div>
            <div id="about">
                                    <strong>欢迎你的到来：</strong><br/>
                                我们希望这里留下你们的脚印：最诚心学习Linux的小鸟们，最热爱Linux的朋友们，最精通Linux的高手们。

我们的希望从2008年9月9日开始。                <p></p>
                    <div class="alignright">
                        <em>roc</em>
                    </div>
                            </div>
    	</div><!--#header-->
        <div id="main">
<div id="left-block">
    <div class="box"><h3>捐款 &#8211; 点击红心</h3>			<div class="textwidget">如果博文对您有所帮助，希望能得到您的鼓励捐款。
<br /><br />
<a href=http://roclinux.cn/?page_id=2959><img src=http://roclinux.cn/wp-content/uploads/2016/01/donate_icon_172.png></img></a></div>
		</div><div class="box"><h3>专题</h3><div class="menu-category_list-container"><ul id="menu-category_list" class="menu"><li id="menu-item-3789" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3789"><a href="http://roclinux.cn/?page_id=3769">官方发布</a></li>
<li id="menu-item-3786" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3786"><a href="http://roclinux.cn/?page_id=3775">看日记学git</a></li>
<li id="menu-item-3792" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3792"><a href="http://roclinux.cn/?page_id=3763">别怕Linux编程</a></li>
<li id="menu-item-3794" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3794"><a href="http://roclinux.cn/?page_id=3759">Linux命令五分钟</a></li>
<li id="menu-item-3795" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3795"><a href="http://roclinux.cn/?page_id=3755">fedora专题</a></li>
<li id="menu-item-3790" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3790"><a href="http://roclinux.cn/?page_id=3767">名书名人</a></li>
<li id="menu-item-3793" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3793"><a href="http://roclinux.cn/?page_id=3761">不能不懂脚本</a></li>
<li id="menu-item-3784" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3784"><a href="http://roclinux.cn/?page_id=3779">站长发言</a></li>
<li id="menu-item-3787" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3787"><a href="http://roclinux.cn/?page_id=3773">每日E文</a></li>
<li id="menu-item-3791" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3791"><a href="http://roclinux.cn/?page_id=3765">北邮人技术笔试</a></li>
<li id="menu-item-3783" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3783"><a href="http://roclinux.cn/?page_id=3781">谈天说地</a></li>
<li id="menu-item-3788" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3788"><a href="http://roclinux.cn/?page_id=3771">手把手教你建博客</a></li>
<li id="menu-item-3785" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3785"><a href="http://roclinux.cn/?page_id=3777">硬件我发烧</a></li>
</ul></div></div><div class="box"><h3>官方微博</h3>			<div class="textwidget"><iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=5&isTitle=0&noborder=0&isWeibo=1&isFans=0&uid=1751201045&verifier=90e9f3a2&dpc=1"></iframe></div>
		</div>		<div class="box">		<h3>看看最新文章</h3>		<ul>
					<li>
				<a href="http://roclinux.cn/?p=3871">奇葩RFC，对要求等级的约定</a>
						</li>
					<li>
				<a href="http://roclinux.cn/?p=3731">《海量运维、运营规划之道》- 写给运维架构师</a>
						</li>
					<li>
				<a href="http://roclinux.cn/?p=3666">哪些公司在赞助Velocity性能与运维大会？</a>
						</li>
					<li>
				<a href="http://roclinux.cn/?p=3592">Google C++编程规范 – 第三十九条 -《访问控制》</a>
						</li>
					<li>
				<a href="http://roclinux.cn/?p=3590">Google C++编程规范 – 第三十八条 -《运算符重载》</a>
						</li>
					<li>
				<a href="http://roclinux.cn/?p=3588">Google C++编程规范 – 第三十七条 -《接口》</a>
						</li>
					<li>
				<a href="http://roclinux.cn/?p=3586">Google C++编程规范 – 第三十六条 -《多重继承》</a>
						</li>
					<li>
				<a href="http://roclinux.cn/?p=3584">Google C++编程规范 – 第三十五条 -《继承》</a>
						</li>
					<li>
				<a href="http://roclinux.cn/?p=3580">Google C++编程规范 – 第三十四条 -《结构体和类》</a>
						</li>
					<li>
				<a href="http://roclinux.cn/?p=3504">Google C++编程规范 – 第三十三条 -《委托构造函数和继承构造函数》</a>
						</li>
				</ul>
		</div>		<div class="box"><h3>文章发布时间日历</h3><div id="calendar_wrap" class="calendar_wrap"><table id="wp-calendar">
	<caption>2016年三月</caption>
	<thead>
	<tr>
		<th scope="col" title="星期一">一</th>
		<th scope="col" title="星期二">二</th>
		<th scope="col" title="星期三">三</th>
		<th scope="col" title="星期四">四</th>
		<th scope="col" title="星期五">五</th>
		<th scope="col" title="星期六">六</th>
		<th scope="col" title="星期日">日</th>
	</tr>
	</thead>

	<tfoot>
	<tr>
		<td colspan="3" id="prev"><a href="http://roclinux.cn/?m=201503">&laquo; 3月</a></td>
		<td class="pad">&nbsp;</td>
		<td colspan="3" id="next" class="pad">&nbsp;</td>
	</tr>
	</tfoot>

	<tbody>
	<tr>
		<td colspan="1" class="pad">&nbsp;</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td>
	</tr>
	<tr>
		<td>7</td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td><td>13</td>
	</tr>
	<tr>
		<td>14</td><td>15</td><td>16</td><td>17</td><td>18</td><td>19</td><td>20</td>
	</tr>
	<tr>
		<td>21</td><td id="today">22</td><td>23</td><td>24</td><td>25</td><td>26</td><td>27</td>
	</tr>
	<tr>
		<td>28</td><td>29</td><td>30</td><td>31</td>
		<td class="pad" colspan="3">&nbsp;</td>
	</tr>
	</tbody>
	</table></div></div></div><!--#left-block-->
    <div id="main-block">
        <div class="left-line">
            <div id="content">
            	                    <ul>
                    	                        	<li class="post-2449 post type-post status-publish format-standard hentry category-5min_command tag-dig tag-dns tag-692 tag-582" id="post-2449">
                                <div class="date"><a href="http://roclinux.cn/?p=2449" rel="nofollow">22<span>8月</span></a></div>
                                <div class="title">
                                    <h2><a href="http://roclinux.cn/?p=2449" rel="bookmark" title="Permalink to: 《dig挖出DNS的秘密》-linux命令五分钟系列之三十四">《dig挖出DNS的秘密》-linux命令五分钟系列之三十四</a></h2>
                                </div>
                                <div class="postdata">
                                    <span class="category"><a href="http://roclinux.cn/?cat=3" rel="category">Linux命令五分钟</a></span>
                                </div>
                        		<div class="entry">
                                                                    		    <p><strong>本原创文章属于<a href="http://roclinux.cn/" target="_blank">《Linux大棚》</a>博客。</strong></p>
<p><strong>博客地址为<a href="http://roclinux.cn/" target="_blank">http://roclinux.cn</a>。</strong></p>
<p><strong>文章作者为roc。</strong></p>
<p><strong>===</strong></p>
<p><span style="color: #0000ff;"><strong>【初次见面】</strong></span></p>
<p>我相信使用nslookup的同学一定比使用dig的同学多，所以还是有必要花些时间给大家介绍一下dig的。</p>
<p>dig，和nslookup作用有些类似，都是DNS查询工具。</p>
<p>dig，其实是一个缩写，即Domain Information Groper。</p>
<p>一些专业的DNS管理员在追查DNS问题时，都乐于使用dig命令，是看中了dig设置灵活、输出清晰、功能强大的特点。</p>
<p><span style="color: #0000ff;"><strong>【最简单的dig用法】</strong></span></p>
<p>最简单的dig用法，当然就是直接输入dig按回车。</p>
<p><span id="more-2449"></span></p>
<pre class="brush: shell; auto-links: false;">$ dig

; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.10.rc1.el6_3.2 &lt;&lt;&gt;&gt; //Dig命令的版本信息
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;</pre>
<p>从上面的输出，你一定观察到了，当直接使用dig命令，不加任何参数和选项时，dig会向默认的上连DNS服务器查询“.”（根域）的NS记录。</p>
<p><span style="color: #0000ff;"><strong>【dig加个点】</strong></span></p>
<p>刚才直接输入dig，这次我们在后面加上一个“.”，看看结果和刚才有何区别：</p>
<pre class="brush: shell; auto-links: false;">$ dig .

; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.10.rc1.el6_3.2 &lt;&lt;&gt;&gt; .
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;</pre>
<p><span style="color: #0000ff;"><strong>【我想用google-DNS来查baidu.com的A记录】</strong></span></p>
<pre class="brush: shell; auto-links: false;">$ dig @8.8.8.8 www.baidu.com A //命令格式为dig @dnsserver name querytype

; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.10.rc1.el6_3.2 &lt;&lt;&gt;&gt; @8.8.8.8 www.baidu.com A
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;</pre>
<p>从这个例子，大家学习到了dig的基本的命令格式是：</p>
<pre class="brush: shell; auto-links: false;">dig @dnsserver name querytype</pre>
<p>如果你设置的dnsserver是一个域名，那么dig会首先通过默认的上连DNS服务器去查询对应的IP地址，然后再以设置的dnsserver为上连DNS服务器。<br />
如果你没有设置@dnsserver，那么dig就会依次使用/etc/resolv.conf里的地址作为上连DNS服务器。<br />
而对于querytype，如果你看过我上一篇有关nslookup命令的讲解，那么你应该对querytype有所了解，你可以设置A/AAAA/PTR/MX/ANY等值，默认是查询A记录。</p>
<p><span style="color: #0000ff;"><strong>【一些常用的选项】</strong></span></p>
<p><strong>1 -c选项</strong>，可以设置协议类型（class），包括IN(默认)、CH和HS。</p>
<p><strong>2 -f选项</strong>，dig支持从一个文件里读取内容进行批量查询，这个非常体贴和方便。文件的内容要求一行为一个查询请求。来个实际例子吧：</p>
<pre class="brush: shell; auto-links: false;">$ cat querylist //文件内容，共有两个域名需要查询
www.baidu.com
www.sohu.com
$ dig -f querylist -c IN -t A//设置-f参数开始批量查询

; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.10.rc1.el6_3.2 &lt;&lt;&gt;&gt; www.baidu.com
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.10.rc1.el6_3.2 &lt;&lt;&gt;&gt; www.sohu.com
;; Got answer:
;; -&gt;&gt;HEADER&lt;</pre>
<p><strong>3 -4和-6两个选项</strong>，用于设置仅适用哪一种作为查询包传输协议，分别对应着IPv4和IPv6。</p>
<p><strong>4 -t选项</strong>，用来设置查询类型，默认情况下是A，也可以设置MX等类型，来一个例子：</p>
<pre class="brush: shell; auto-links: false;">$ dig roclinux.cn -t MX

; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.10.rc1.el6_3.2 &lt;&lt;&gt;&gt; roclinux.cn -t MX
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;</pre>
<p><strong>5 -q选项</strong>，其实它本身是一个多余的选项，但是它在复杂的dig命令中又是那么的有用。-q选项可以显式设置你要查询的域名，这样可以避免和其他众多的参数、选项相混淆，提高了命令的可读性，来个例子：</p>
<pre class="brush: shell; auto-links: false;">$ dig -q www.roclinux.cn

; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.10.rc1.el6_3.2 &lt;&lt;&gt;&gt; -q www.roclinux.cn
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;</pre>
<p><strong>6 -x选项</strong>，是逆向查询选项。可以查询IP地址到域名的映射关系。举一个例子：</p>
<pre class="brush: shell; auto-links: false;">$ dig -x 193.0.14.129

; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.10.rc1.el6_3.2 &lt;&lt;&gt;&gt; -x 193.0.14.129
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;</pre>
<p><span style="color: #0000ff;"><strong>【dig特有的查询选项（query option）】</strong></span></p>
<p>和刚才的选项不同，dig还有一批所谓的“查询选项”，这批选项的使用与否，会影响到dig的查询方式或输出的结果信息，因此对于这批选项，dig要求显式的在其前面统一的加上一个“+”（加号），这样dig识别起来会更方便，同时命令的可读性也会更强。<br />
dig总共有42个查询选项，涉及到DNS信息的方方面面，如此多的查询选项，本文不会一一赘述，只会挑出最最常用的几个重点讲解。</p>
<p><span style="color: #0000ff;"><strong>【TCP代替UDP】</strong></span></p>
<p>众所周知，DNS查询过程中的交互是采用UDP的。如果你希望采用TCP方式，需要这样：</p>
<pre class="brush: shell; auto-links: false;">$ dig +tcp www.baidu.com

; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.10.rc1.el6_3.2 &lt;&lt;&gt;&gt; +tcp www.baidu.com
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;</pre>
<p><span style="color: #0000ff;"><strong>【默认追加域】</strong></span></p>
<p>大家直接看例子，应该就能理解“默认域”的概念了，也就能理解+domain=somedomain的作用了：</p>
<pre class="brush: shell; auto-links: false;">dig +domain=baidu.com image

; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.10.rc1.el6_3.2 &lt;&lt;&gt;&gt; +domain=baidu.com image
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;</pre>
<p><span style="color: #0000ff;"><strong>【跟踪dig全过程】</strong></span></p>
<p>dig非常著名的一个查询选项就是+trace，当使用这个查询选项后，dig会从根域查询一直跟踪直到查询到最终结果，并将整个过程信息输出出来。</p>
<pre class="brush: shell; auto-links: false;">$ dig +trace roclinux.cn 

; &lt;&lt;&gt;&gt; DiG 9.2.4 &lt;&lt;&gt;&gt; +trace roclinux.cn 
;; global options:  printcmd
.                       335937  IN      NS      l.root-servers.net.
.                       335937  IN      NS      b.root-servers.net.
.                       335937  IN      NS      d.root-servers.net.
.                       335937  IN      NS      k.root-servers.net.
.                       335937  IN      NS      h.root-servers.net.
.                       335937  IN      NS      j.root-servers.net.
.                       335937  IN      NS      a.root-servers.net.
.                       335937  IN      NS      e.root-servers.net.
.                       335937  IN      NS      c.root-servers.net.
.                       335937  IN      NS      m.root-servers.net.
.                       335937  IN      NS      g.root-servers.net.
.                       335937  IN      NS      i.root-servers.net.
.                       335937  IN      NS      f.root-servers.net.
;; Received 400 bytes from 10.23.0.231#53(10.23.0.231) in 0 ms //从本地DNS查找到根域DNS列表

cn.                     172800  IN      NS      c.dns.cn.
cn.                     172800  IN      NS      a.dns.cn.
cn.                     172800  IN      NS      b.dns.cn.
cn.                     172800  IN      NS      e.dns.cn.
cn.                     172800  IN      NS      ns.cernet.net.
cn.                     172800  IN      NS      d.dns.cn.
;; Received 292 bytes from 192.228.79.201#53(b.root-servers.net) in 460 ms //选择了b.root-servers.net这台根域DNS来查找cn.域DNS列表

roclinux.cn.            21600   IN      NS      ns11.edong.com.
roclinux.cn.            21600   IN      NS      ns12.edong.com.
;; Received 76 bytes from 203.119.27.1#53(c.dns.cn) in 0 ms //选择了c.dns.cn这台cn.域DNS服务器来查找roclinux.cn的DNS列表

roclinux.cn.            3600    IN      A       116.255.245.206
roclinux.cn.            3600    IN      NS      ns12.edong.com.
roclinux.cn.            3600    IN      NS      ns11.edong.com.
;; Received 124 bytes from 61.147.124.145#53(ns11.edong.com) in 104 ms //最终查找到A记录</pre>
<p><span style="color: #0000ff;"><strong>【精简dig输出】</strong></span></p>
<p>1 使用+nocmd的话，可以节省输出dig版本信息。</p>
<p>2 使用+short的话，仅会输出最精简的CNAME信息和A记录，其他都不会输出。就像这样：</p>
<pre class="brush: shell; auto-links: false;">$ dig +short www.baidu.com
www.a.shifen.com.
119.75.218.77
119.75.217.56</pre>
<p>3 使用+nocomment的话，可以节省输出dig的详情注释信息。</p>
<p>4 使用+nostat的话，最后的统计信息也不会输出。当+nocmd、+nocomment和+nostat都是用上，是这样：</p>
<pre class="brush: shell; auto-links: false;">$ dig +nocmd +nocomment +nostat www.baidu.com
;www.baidu.com.                 IN      A
www.baidu.com.          260     IN      CNAME   www.a.shifen.com.
www.a.shifen.com.       244     IN      A       119.75.217.56
www.a.shifen.com.       244     IN      A       119.75.218.77</pre>
<p><span style="color: #0000ff;"><strong>【我们还需要学习什么】</strong></span></p>
<p>坚持看我的博客的同学，已经掌握了nslookup和dig两个DNS工具，我想，下一步你可以<br />
自己搭建一套内部的DNS服务器了，自己设置master/slave服务器，自己添加Zone，<br />
自己添加正解、反解，自己设置缓存超时等等，相信通过这一番折腾，<br />
你对DNS会有不一样的理解和认识。</p>
<p>谢谢！</p>
                        		</div>
                                <div class="link-pages">
                                                                    </div>
                        		<p>作者 rocrocket 于 1:30 上午 </p>
                        		<p>文章标签: <a href="http://roclinux.cn/?tag=dig" rel="tag">dig</a>, <a href="http://roclinux.cn/?tag=dns" rel="tag">dns</a>, <a href="http://roclinux.cn/?tag=%e5%9f%9f%e5%90%8d" rel="tag">域名</a>, <a href="http://roclinux.cn/?tag=%e5%b7%a5%e5%85%b7" rel="tag">工具</a></p>                        	</li>
                    	                     </ul>
                    
<!-- You can start editing here. -->

    <h3>8 Comments to <em>《dig挖出DNS的秘密》-linux命令五分钟系列之三十四</em></h3>
    <ul class="comments-list">		<li id="comment-3790" class="pingback even thread-even depth-1">
			<article id="div-comment-3790" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href='http://www.chinabin.cn/opensource-world/816.html' rel='external nofollow' class='url'>Linxu dig 命令详解 | 姚小虎的IT生活</a></b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://roclinux.cn/?p=2449#comment-3790">
							<time datetime="2012-09-11T15:35:12+00:00">
								九月 11, 2012 3:35 下午							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[&#8230;] 备注：本文转载自Linux大棚，略加修改。                      【上篇】linux nslookup命令详解 [&#8230;]</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-3819" class="comment odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-3819" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn">meow</b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://roclinux.cn/?p=2449#comment-3819">
							<time datetime="2012-09-26T17:57:52+00:00">
								九月 26, 2012 5:57 下午							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>非常好的东西，学习了。</p>
<p class="thdrpy"><a href="javascript:void(0)" onclick="movecfm(event,3819,1,'meow');">回复</a></p>				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-4024" class="pingback even thread-even depth-1">
			<article id="div-comment-4024" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href='http://www.chinabin.cn/code-space/about-linux/816.html' rel='external nofollow' class='url'>Linxu dig 命令详解 | 姚小虎的IT生活</a></b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://roclinux.cn/?p=2449#comment-4024">
							<time datetime="2012-11-29T16:47:27+00:00">
								十一月 29, 2012 4:47 下午							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[&#8230;] 备注：本文转载自Linux大棚，略加修改。                      【上篇】linux nslookup命令详解【下篇】ubuntu设置dns来解析ipv6的网站 [&#8230;]</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-9125" class="comment odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-9125" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href='http://www.leafonsword.org' rel='external nofollow' class='url'>刀尖红叶</a></b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://roclinux.cn/?p=2449#comment-9125">
							<time datetime="2014-01-22T11:51:24+00:00">
								一月 22, 2014 11:51 上午							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>好文！</p>
<p class="thdrpy"><a href="javascript:void(0)" onclick="movecfm(event,9125,1,'刀尖红叶');">回复</a></p>				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-9986" class="comment even thread-even depth-1">
			<article id="div-comment-9986" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href='http://www.elesos.com' rel='external nofollow' class='url'>www.elesos.com</a></b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://roclinux.cn/?p=2449#comment-9986">
							<time datetime="2014-04-19T10:12:53+00:00">
								四月 19, 2014 10:12 上午							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>总结得相当不错，支持下。<br />
by <a href="http://www.elesos.com" rel="nofollow">http://www.elesos.com</a> 站长<br />
已转发</p>
<p class="thdrpy"><a href="javascript:void(0)" onclick="movecfm(event,9986,1,'www.elesos.com');">回复</a></p>				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-36717" class="comment odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-36717" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href='http://www.smartwei.com' rel='external nofollow' class='url'>shiwei</a></b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://roclinux.cn/?p=2449#comment-36717">
							<time datetime="2014-06-11T16:50:29+00:00">
								六月 11, 2014 4:50 下午							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>dig +trace 这句执行的结果中，看到<br />
roclinux.cn.            21600   IN      NS      ns11.edong.com.<br />
roclinux.cn.            21600   IN      NS      ns12.edong.com.</p>
<p>roclinux.cn.            3600    IN      NS      ns12.edong.com.<br />
roclinux.cn.            3600    IN      NS      ns11.edong.com.</p>
<p>这里DNS的缓存时间，一个是21600，一个是3600，到底以那个为准呢</p>
<p class="thdrpy"><a href="javascript:void(0)" onclick="movecfm(event,36717,1,'shiwei');">回复</a></p>				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-232198" class="pingback even thread-even depth-1">
			<article id="div-comment-232198" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href='http://zhuyicun.ml/?p=16' rel='external nofollow' class='url'>DNS利器-dig | 屋顶的那片瓦</a></b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://roclinux.cn/?p=2449#comment-232198">
							<time datetime="2015-12-02T22:42:50+00:00">
								十二月 2, 2015 10:42 下午							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[&#8230;] <a href="http://roclinux.cn/?p=2449" rel="nofollow">http://roclinux.cn/?p=2449</a> [&#8230;]</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-233834" class="comment odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-233834" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn">oscar</b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://roclinux.cn/?p=2449#comment-233834">
							<time datetime="2016-02-02T16:59:52+00:00">
								二月 2, 2016 4:59 下午							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>+trace 这个命令选项 嗲</p>
<p class="thdrpy"><a href="javascript:void(0)" onclick="movecfm(event,233834,1,'oscar');">回复</a></p>				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ul>
    

    				<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="/?p=2449#respond" style="display:none;">取消回复</a></small></h3>				<form action="http://roclinux.cn/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate>
					<p class="comment-notes"><span id="email-notes">电子邮件地址不会被公开。</span> 必填项已用<span class="required">*</span>标注</p><p class="comment-form-comment"><label for="comment">评论</label> <textarea id="comment" name="comment" cols="45" rows="8"  aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">姓名 <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">电子邮件 <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">站点</label> <input id="url" name="url" type="url" value="" size="30" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="发表评论" /> <input type='hidden' name='comment_post_ID' value='2449' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="4bef16eb2d" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="114"/></p><p><input type="hidden" id="comment_reply_ID" name="comment_reply_ID" value="0" /><input type="hidden" id="comment_reply_dp" name="comment_reply_dp" value="0" /></p><div id="cancel_reply" style="display:none;"><a href="javascript:void(0)" onclick="movecfm(null,0,1,null);" style="color:red;">取消回复</a></div><script type="text/javascript">
/* <![CDATA[ */
var commentformid = "respond";
var USERINFO = false;
var atreply = "authorlink";
/* ]]> */
</script>
<script type="text/javascript" src="http://roclinux.cn/wp-content/plugins/wordpress-thread-comment/wp-thread-comment.js.php?jsver=common"></script>
				</form>
					</div><!-- #respond -->
		                            </div><!--#content-->
        </div><!--.left-line-->
                    <div id="footer">
			<span class="copyright">&copy; 2016 Linux大棚. All Rights Reserved.</span>
                        <span class="links">
                            <a href="http://roclinux.cn/?feed=rss2" title="Syndicate this site using RSS" class="rss">Entries <abbr title="Really Simple Syndication">RSS</abbr></a>
                            <a href="http://roclinux.cn/?feed=comments-rss2" title="The latest comments to all posts in RSS" class="rss">Comments <abbr title="Really Simple Syndication">RSS</abbr></a>
                        </span>
                    </div><!--#footer-->
                <!--#do not delete this part#-->
                </div><!--#main-block-->
            </div><!--#main-->
        </div><!--#root-->
	<script type="text/javascript" src="http://roclinux.cn/wp-content/plugins/syntax-highlighter/3.0.83/js/shCore.js?ver=3.0.83"></script>
<script type="text/javascript" src="http://roclinux.cn/wp-content/plugins/syntax-highlighter/3.0.83/js/shBrushBash.js?ver=3.0.83"></script>
<script type='text/javascript' src='http://roclinux.cn/wp-content/plugins/akismet/_inc/form.js?ver=3.1.8'></script>
<script type="text/javascript">//<![CDATA[
SyntaxHighlighter.all();
//]]></script>
<script type='text/javascript' src='http://roclinux.cn/wp-includes/js/wp-embed.min.js?ver=4.4.2'></script>
    </body>
</html>
