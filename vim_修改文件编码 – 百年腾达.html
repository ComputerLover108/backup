<!DOCTYPE html>
<html lang="zh-CN" class="no-js">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="http://hytd.org/xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="http://hytd.org/wp-content/themes/twentyfifteen/js/html5.js"></script>
	<![endif]-->
	<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<title>vim_修改文件编码 &#8211; 百年腾达</title>
<link rel="alternate" type="application/rss+xml" title="百年腾达 &raquo; Feed" href="http://hytd.org/?feed=rss2" />
<link rel="alternate" type="application/rss+xml" title="百年腾达 &raquo; 评论Feed" href="http://hytd.org/?feed=comments-rss2" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hytd.org\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.2"}};
			!function(a,b,c){function d(a){var c,d=b.createElement("canvas"),e=d.getContext&&d.getContext("2d"),f=String.fromCharCode;return e&&e.fillText?(e.textBaseline="top",e.font="600 32px Arial","flag"===a?(e.fillText(f(55356,56806,55356,56826),0,0),d.toDataURL().length>3e3):"diversity"===a?(e.fillText(f(55356,57221),0,0),c=e.getImageData(16,16,1,1).data.toString(),e.fillText(f(55356,57221,55356,57343),0,0),c!==e.getImageData(16,16,1,1).data.toString()):("simple"===a?e.fillText(f(55357,56835),0,0):e.fillText(f(55356,57135),0,0),0!==e.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='twentyfifteen-fonts-css'  href='https://fonts.googleapis.com/css?family=Noto+Sans%3A400italic%2C700italic%2C400%2C700%7CNoto+Serif%3A400italic%2C700italic%2C400%2C700%7CInconsolata%3A400%2C700&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='http://hytd.org/wp-content/themes/twentyfifteen/genericons/genericons.css?ver=3.2' type='text/css' media='all' />
<link rel='stylesheet' id='twentyfifteen-style-css'  href='http://hytd.org/wp-content/themes/twentyfifteen/style.css?ver=4.4.2' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentyfifteen-ie-css'  href='http://hytd.org/wp-content/themes/twentyfifteen/css/ie.css?ver=20141010' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentyfifteen-ie7-css'  href='http://hytd.org/wp-content/themes/twentyfifteen/css/ie7.css?ver=20141010' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='http://hytd.org/wp-includes/js/jquery/jquery.js?ver=1.11.3'></script>
<script type='text/javascript' src='http://hytd.org/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<link rel='https://api.w.org/' href='http://hytd.org/?rest_route=/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://hytd.org/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://hytd.org/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='FTP命令' href='http://hytd.org/?p=4011' />
<link rel='next' title='css样式大全(整理版)' href='http://hytd.org/?p=4015' />
<meta name="generator" content="WordPress 4.4.2" />
<link rel="canonical" href="http://hytd.org/?p=4013" />
<link rel='shortlink' href='http://hytd.org/?p=4013' />
<link rel="alternate" type="application/json+oembed" href="http://hytd.org/?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=http%3A%2F%2Fhytd.org%2F%3Fp%3D4013" />
</head>

<body class="single single-post postid-4013 single-format-standard">
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">跳至内容</a>

	<div id="sidebar" class="sidebar">
		<header id="masthead" class="site-header" role="banner">
			<div class="site-branding">
										<p class="site-title"><a href="http://hytd.org/" rel="home">百年腾达</a></p>
									<button class="secondary-toggle">菜单和挂件</button>
			</div><!-- .site-branding -->
		</header><!-- .site-header -->

			<div id="secondary" class="secondary">

		
		
					<div id="widget-area" class="widget-area" role="complementary">
				<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="http://hytd.org/">
				<label>
					<span class="screen-reader-text">搜索：</span>
					<input type="search" class="search-field" placeholder="搜索&hellip;" value="" name="s" title="搜索：" />
				</label>
				<input type="submit" class="search-submit screen-reader-text" value="搜索" />
			</form></aside><aside id="text-5" class="widget widget_text">			<div class="textwidget"><h1>请使用搜索</h1></div>
		</aside><aside id="categories-2" class="widget widget_categories"><h2 class="widget-title">分类目录</h2><label class="screen-reader-text" for="cat">分类目录</label><select name='cat' id='cat' class='postform' >
	<option value='-1'>选择分类目录</option>
	<option class="level-0" value="72">MY&nbsp;&nbsp;(21)</option>
	<option class="level-0" value="1">未分类&nbsp;&nbsp;(1,782)</option>
</select>

<script type='text/javascript'>
/* <![CDATA[ */
(function() {
	var dropdown = document.getElementById( "cat" );
	function onCatChange() {
		if ( dropdown.options[ dropdown.selectedIndex ].value > 0 ) {
			location.href = "http://hytd.org/?cat=" + dropdown.options[ dropdown.selectedIndex ].value;
		}
	}
	dropdown.onchange = onCatChange;
})();
/* ]]> */
</script>

</aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h2 class="widget-title">近期文章</h2>		<ul>
					<li>
				<a href="http://hytd.org/?p=4052">php.ini</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4046">去除vim自动生成的un~文件</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4044">VIM学习笔记 备份文件(Backup)</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4041">PHP_Day1_笔记</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4038">Emacs Tutorial</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4035">jQuery_Day2_笔记</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4033">jQuery_笔记</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4031">grub.cfg</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4029">JS_Day7_笔记</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4026">GRUB2引导非第一分区</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4022">Makefile.include.header:97: *** Error: unable to find the sources of your current Linux kernel</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4019">capslk esc互换 esc ~互换</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4017">php_funclist</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4015">css样式大全(整理版)</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4013">vim_修改文件编码</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4011">FTP命令</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4009">将Caps Lock转换成Esc(windows and linux)</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4007">通过vim字典补全，实现php函数名自动补全</a>
						</li>
					<li>
				<a href="http://hytd.org/?p=4005">CSS-后代选择器与子选择器的区别</a>
						</li>
				</ul>
		</aside>		<aside id="meta-2" class="widget widget_meta"><h2 class="widget-title">功能</h2>			<ul>
						<li><a href="http://hytd.org/wp-login.php">登录</a></li>
			<li><a href="http://hytd.org/?feed=rss2">文章<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://hytd.org/?feed=comments-rss2">评论<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://cn.wordpress.org/" title="基于WordPress，一个优美、先进的个人信息发布平台。">WordPress.org</a></li>			</ul>
			</aside>			</div><!-- .widget-area -->
		
	</div><!-- .secondary -->

	</div><!-- .sidebar -->

	<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
<article id="post-4013" class="post-4013 post type-post status-publish format-standard hentry category-uncategorized tag-vim">
	
	<header class="entry-header">
		<h1 class="entry-title">vim_修改文件编码</h1>	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>vim 修改文件编码<br />
set fileencoding=utf8 ;</p>
<p>在 Vim 中， 有四个与编码有关的选项， 它们是： fileencodings、 fileencoding、 encoding 和 termencoding。 在实际使用中， 任何一个选项出现错误， 都会导致出现乱码。 因此， 每一个 Vim 用户都应该明确这四个选项的含义。 下面， 我们详细介绍一下这四个选项的含义和作用。<br />
1 encoding</p>
<p>encoding 是 Vim 内部使用的字符编码方式。 当我们设置了 encoding 之后， Vim 内部所有的 buffer、 寄存器、 脚本中的字符串等， 全都使用这个编码。 Vim 在工作的时候， 如果编码方式与它的内部编码不一致， 它会先把编码转换成内部编码。 如果工作用的编码中含有无法转换为内部编码的字符， 在这些字符就会丢失。 因此，在选择 Vim 的内部编码的时候， 一定要使用一种表现能力足够强的编码， 以免影响正常工作。</p>
<p>由于 encoding 选项涉及到 Vim 中所有字符的内部表示， 因此只能在 Vim 启动的时候设置一次。 在 Vim 工作过程中修改 encoding 会造成非常多的问题。 如果没有特别的理由， 请始终将 encoding 设置为 utf-8。 为了避免在非 UTF-8 的系统如 Windows 下， 菜单和系统提示出现乱码， 可同时做这几项设置：<br />
set encoding=utf-8<br />
set langmenu=zh_CN.UTF-8<br />
language message zh_CN.UTF-8<br />
2 termencoding</p>
<p>termencoding 是 Vim 用于屏幕显示的编码， 在显示的时候， Vim 会把内部编码转换为屏幕编码， 再用于输出。 内部编码中含有无法转换为屏幕编码的字符时， 该字符会变成问号， 但不会影响对它的编辑操作。 如果 termencoding 没有设置， 则直接使用 encoding 不进行转换。</p>
<p>举个例子， 当你在 Windows 下通过 telnet 登录 Linux 工作站时， 由于 Windows 的 telnet 是 GBK 编码的， 而 Linux 下使用 UTF-8 编码， 你在 telnet 下的 Vim 中就会乱码。 此时有两种消除乱码的方式： 一是把 Vim 的 encoding 改为 gbk， 另一种方法是保持 encoding 为 utf-8， 把 termencoding 改为 gbk， 让 Vim 在显示的时候转码。 显然， 使用前一种方法时， 如果遇到编辑的文件中含有 GBK 无法表示的字符时， 这些字符就会丢失。 但如果使用后一种方法， 虽然由于终端所限， 这些字符无法显示， 但在编辑过程中这些字符是不会丢失的。</p>
<p>对于图形界面下的 GVim， 它的显示不依赖 TERM， 因此 termencoding 对于它没有意义。 在 GTK2 下的 GVim 中， termencoding 永远是 utf-8， 并且不能修改。 而 Windows 下的 GVim 则忽略 termencoding 的存在。<br />
3 fileencoding</p>
<p>当 Vim 从磁盘上读取文件的时候， 会对文件的编码进行探测。 如果文件的编码方式和 Vim 的内部编码方式不同， Vim 就会对编码进行转换。 转换完毕后， Vim 会将 fileencoding 选项设置为文件的编码。 当 Vim 存盘的时候， 如果 encoding 和 fileencoding 不一样， Vim 就会进行编码转换。 因此， 通过打开文件后设置 fileencoding， 我们可以将文件由一种编码转换为另一种编码。 但是， 由前面的介绍可以看出， fileencoding 是在打开文件的时候， 由 Vim 进行探测后自动设置的。 因此， 如果出现乱码， 我们无法通过在打开文件后重新设置 fileencoding 来纠正乱码。<br />
4 fileencodings</p>
<p>编码的自动识别是通过设置 fileencodings 实现的， 注意是复数形式。 fileencodings 是一个用逗号分隔的列表， 列表中的每一项是一种编码的名称。 当我们打开文件的时候， VIM 按顺序使用 fileencodings 中的编码进行尝试解码， 如果成功的话， 就使用该编码方式进行解码， 并将 fileencoding 设置为这个值， 如果失败的话， 就继续试验下一个编码。</p>
<p>因此， 我们在设置 fileencodings 的时候， 一定要把要求严格的、 当文件不是这个编码的时候更容易出现解码失败的编码方式放在前面， 把宽松的编码方式放在后面。</p>
<p>例如， latin1 是一种非常宽松的编码方式， 任何一种编码方式得到的文本， 用 latin1 进行解码， 都不会发生解码失败 —— 当然， 解码得到的结果自然也就是理所当然的“乱码”。 因此， 如果你把 latin1 放到了 fileencodings 的第一位的话， 打开任何中文文件都是乱码也就是理所当然的了。</p>
<p>以下是滇狐推荐的一个 fileencodings 设置：<br />
set fileencodings=ucs-bom,utf-8,cp936,gb18030,big5,euc-jp,euc-kr,latin1</p>
<p>其中， ucs-bom 是一种非常严格的编码， 非该编码的文件几乎没有可能被误判为 ucs-bom， 因此放在第一位。</p>
<p>utf-8 也相当严格， 除了很短的文件外 (例如许多人津津乐道的 GBK 编码的“联通”被误判为 UTF-8 编码的经典错误)， 现实生活中一般文件是几乎不可能被误判的， 因此放在第二位。</p>
<p>接下来是 cp936 和 gb18030， 这两种编码相对宽松， 如果放前面的话， 会出现大量误判， 所以就让它们靠后一些。 cp936 的编码空间比 gb18030 小， 所以把 cp936 放在 gb18030 前面。</p>
<p>至于 big5、euc-jp 和 euc-kr， 它们的严格程度和 cp936 差不多， 把它们放在后面， 在编辑这些编码的文件的时候必然出现大量误判， 但这是 Vim 内置编码探测机制没有办法解决的事。 由于中国用户很少有机会编辑这些编码的文件， 因此我们还是决定把 cp936 和 gb18030 前提以保证这些编码的识别。</p>
<p>最后就是 latin1 了。 它是一种极其宽松的编码， 以至于我们不得不把它放在最后一位。 不过可惜的是， 当你碰到一个真的 latin1 编码的文件时， 绝大部分情况下， 它没有机会 fall-back 到 latin1， 往往在前面的编码中就被误判了。 不过， 正如前面所说的， 中国用户没有太多机会接触这样的文件。</p>
<p>如果编码被误判了， 解码后的结果就无法被人类识别， 于是我们就说， 这个文件乱码了。 此时， 如果你知道这个文件的正确编码的话， 可以在打开文件的时候使用 ++enc=encoding 的方式来打开文件， 如：</p>
<p>:e ++enc=utf-8 myfile.txt<br />
5 fencview<br />
根据前面的介绍， 我们知道， 通过 Vim 内置的编码识别机制， 识别率是很低的， 尤其是对于简体中文 (GBK/GB18030)、 繁体中文 (Big5)、 日文 (euc-jp) 和韩文 (euc-kr) 之间的识别。 而对于普通用户而言， 肉眼看出一个文件的编码方式也是很不现实的事情。 因此， 滇狐强烈推荐水木社区的 mbbill 开发的 fencview 插件。 该插件使用词频统计的方式识别编码， 正确率非常高。 点击 这里 下载</p>
	</div><!-- .entry-content -->

	
	<footer class="entry-footer">
		<span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="http://hytd.org/?p=4013" rel="bookmark"><time class="entry-date published updated" datetime="2016-03-12T20:05:30+00:00">2016年3月12日</time></a></span><span class="byline"><span class="author vcard"><span class="screen-reader-text">作者 </span><a class="url fn n" href="http://hytd.org/?author=2">HYTD</a></span></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="http://hytd.org/?cat=1" rel="category">未分类</a></span><span class="tags-links"><span class="screen-reader-text">标签 </span><a href="http://hytd.org/?tag=vim" rel="tag">VIM</a></span>			</footer><!-- .entry-footer -->

</article><!-- #post-## -->

	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">文章导航</h2>
		<div class="nav-links"><div class="nav-previous"><a href="http://hytd.org/?p=4011" rel="prev"><span class="meta-nav" aria-hidden="true">上一</span> <span class="screen-reader-text">上篇文章：</span> <span class="post-title">FTP命令</span></a></div><div class="nav-next"><a href="http://hytd.org/?p=4015" rel="next"><span class="meta-nav" aria-hidden="true">下一</span> <span class="screen-reader-text">下篇文章：</span> <span class="post-title">css样式大全(整理版)</span></a></div></div>
	</nav>
		</main><!-- .site-main -->
	</div><!-- .content-area -->


	</div><!-- .site-content -->

	<footer id="colophon" class="site-footer" role="contentinfo">
		<div class="site-info">
						<a href="https://cn.wordpress.org/">自豪地采用WordPress</a>
		</div><!-- .site-info -->
	</footer><!-- .site-footer -->

</div><!-- .site -->

<script type='text/javascript' src='http://hytd.org/wp-content/themes/twentyfifteen/js/skip-link-focus-fix.js?ver=20141010'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var screenReaderText = {"expand":"<span class=\"screen-reader-text\">\u5c55\u5f00\u5b50\u83dc\u5355<\/span>","collapse":"<span class=\"screen-reader-text\">\u6298\u53e0\u5b50\u83dc\u5355<\/span>"};
/* ]]> */
</script>
<script type='text/javascript' src='http://hytd.org/wp-content/themes/twentyfifteen/js/functions.js?ver=20150330'></script>
<script type='text/javascript' src='http://hytd.org/wp-includes/js/wp-embed.min.js?ver=4.4.2'></script>

</body>
</html>
